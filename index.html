<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>100 DSA Problems Tracker - Responsive</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body{
      font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Arial,sans-serif;
      max-width:1200px;
      margin:0 auto;
      padding:8px;
      background:#f8f9fa;
      font-size:14px;
      line-height:1.4;
    }
    
    /* Mobile-first approach */
    @media (min-width: 768px) {
      body {
        padding: 16px;
        font-size: 16px;
      }
    }
    
    header{
      background:white;
      padding:12px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      margin-bottom:12px;
    }
    
    @media (min-width: 768px) {
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
      }
    }
    
    h1{
      font-size:18px;
      margin:0 0 8px 0;
      color:#2c3e50;
      text-align:center;
    }
    
    @media (min-width: 768px) {
      h1 {
        font-size: 24px;
        margin: 0;
        text-align: left;
      }
    }
    
    .stats{
      display:flex;
      gap:12px;
      justify-content:space-around;
      margin-top:12px;
    }
    
    @media (min-width: 768px) {
      .stats {
        gap: 20px;
        margin-top: 0;
        justify-content: flex-end;
      }
    }
    
    .stat-item{
      text-align:center;
      flex:1;
    }
    
    @media (min-width: 768px) {
      .stat-item {
        flex: none;
      }
    }
    
    .stat-number{
      font-size:16px;
      font-weight:bold;
      color:#27ae60;
    }
    
    @media (min-width: 768px) {
      .stat-number {
        font-size: 20px;
      }
    }
    
    .stat-label{
      font-size:10px;
      color:#7f8c8d;
      text-transform:uppercase;
    }
    
    @media (min-width: 768px) {
      .stat-label {
        font-size: 12px;
      }
    }
    
    #progress{
      width:100%;
      height:16px;
      background:#e9ecef;
      border-radius:8px;
      overflow:hidden;
      margin:12px 0;
      box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);
    }
    
    @media (min-width: 768px) {
      #progress {
        height: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }
    }
    
    #bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,#4caf50,#8bc34a);
      transition:width 0.3s ease;
      position:relative;
    }
    
    #bar::after{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3));
    }
    
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:8px;
      margin:12px 0;
    }
    
    @media (min-width: 480px) {
      .grid {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 10px;
      }
    }
    
    @media (min-width: 768px) {
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 12px;
        margin: 20px 0;
      }
    }
    
    .card{
      padding:8px;
      border:2px solid #e9ecef;
      border-radius:8px;
      background:white;
      cursor:pointer;
      transition:all 0.2s ease;
      position:relative;
      min-height:80px;
      display:flex;
      flex-direction:column;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
    }
    
    @media (min-width: 768px) {
      .card {
        padding: 12px;
        border-radius: 12px;
        min-height: 100px;
      }
    }
    
    .card:hover, .card:active{
      border-color:#3498db;
      transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(52,152,219,0.2);
    }
    
    @media (min-width: 768px) {
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(52,152,219,0.2);
      }
    }
    
    .card.solved{
      border-color:#27ae60;
      background:linear-gradient(135deg,#d4edda,#c3e6cb);
    }
    
    .card.solved:hover, .card.solved:active{
      border-color:#e74c3c;
      transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(231,76,60,0.2);
    }
    
    @media (min-width: 768px) {
      .card.solved:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(231,76,60,0.2);
      }
    }
    
    .card.solved::before{
      content:'‚úì';
      position:absolute;
      top:4px;
      right:4px;
      color:#27ae60;
      font-weight:bold;
      font-size:12px;
      background:rgba(39,174,96,0.1);
      padding:2px 4px;
      border-radius:6px;
      border:1px solid #27ae60;
    }
    
    @media (min-width: 768px) {
      .card.solved::before {
        content: '‚úì SOLVED';
        top: 8px;
        right: 8px;
        padding: 2px 6px;
        border-radius: 10px;
      }
    }
    
    .card.locked{
      opacity:0.7;
      cursor:not-allowed;
    }
    
    .card.locked:hover, .card.locked:active{
      transform:none;
      box-shadow:none;
      border-color:#e9ecef;
    }
    
    .problem-number{
      font-size:14px;
      font-weight:bold;
      color:#2c3e50;
      margin-bottom:6px;
    }
    
    @media (min-width: 768px) {
      .problem-number {
        font-size: 16px;
        margin-bottom: 8px;
      }
    }
    
    .card.solved .problem-number{
      color:#155724;
    }
    
    input[type="text"]{
      width:100%;
      padding:6px;
      margin-top:6px;
      border:1px solid #dee2e6;
      border-radius:4px;
      font-size:11px;
      box-sizing:border-box;
      flex:1;
    }
    
    @media (min-width: 768px) {
      input[type="text"] {
        padding: 8px;
        margin-top: 8px;
        border-radius: 6px;
        font-size: 12px;
      }
    }
    
    input[type="text"]:focus{
      outline:none;
      border-color:#3498db;
      box-shadow:0 0 0 2px rgba(52,152,219,0.2);
    }
    
    .controls{
      display:flex;
      gap:6px;
      margin:12px 0;
      flex-wrap:wrap;
      align-items:center;
    }
    
    @media (min-width: 768px) {
      .controls {
        gap: 12px;
        margin: 20px 0;
      }
    }
    
    button{
      padding:8px 12px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-weight:500;
      transition:all 0.2s ease;
      font-size:12px;
      white-space:nowrap;
      touch-action:manipulation;
      -webkit-tap-highlight-color:transparent;
    }
    
    @media (min-width: 768px) {
      button {
        padding: 10px 16px;
        border-radius: 8px;
        font-size: 14px;
      }
    }
    
    button:hover, button:active{
      transform:translateY(-1px);
    }
    
    .btn-primary{
      background:#3498db;
      color:white;
    }
    
    .btn-primary:hover, .btn-primary:active{
      background:#2980b9;
    }
    
    .btn-success{
      background:#27ae60;
      color:white;
    }
    
    .btn-success:hover, .btn-success:active{
      background:#219a52;
    }
    
    .btn-danger{
      background:#e74c3c;
      color:white;
    }
    
    .btn-danger:hover, .btn-danger:active{
      background:#c0392b;
    }
    
    .btn-secondary{
      background:#95a5a6;
      color:white;
    }
    
    .btn-secondary:hover, .btn-secondary:active{
      background:#7f8c8d;
    }
    
    .btn-warning{
      background:#f39c12;
      color:white;
    }
    
    .btn-warning:hover, .btn-warning:active{
      background:#e67e22;
    }
    
    footer{
      margin-top:20px;
      padding:12px;
      background:white;
      border-radius:8px;
      font-size:11px;
      color:#7f8c8d;
      text-align:center;
    }
    
    @media (min-width: 768px) {
      footer {
        margin-top: 30px;
        padding: 20px;
        border-radius: 12px;
        font-size: 13px;
      }
    }
    
    .filter-controls{
      display:flex;
      gap:6px;
      margin:12px 0;
      flex-wrap:wrap;
      align-items:center;
    }
    
    @media (min-width: 768px) {
      .filter-controls {
        gap: 10px;
        margin: 15px 0;
      }
    }
    
    .filter-btn{
      padding:4px 8px;
      border:1px solid #dee2e6;
      border-radius:16px;
      background:white;
      cursor:pointer;
      font-size:10px;
      transition:all 0.2s ease;
      white-space:nowrap;
      touch-action:manipulation;
      -webkit-tap-highlight-color:transparent;
    }
    
    @media (min-width: 768px) {
      .filter-btn {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
      }
    }
    
    .filter-btn.active{
      background:#3498db;
      color:white;
      border-color:#3498db;
    }
    
    .tip{
      background:white;
      padding:10px;
      border-radius:6px;
      margin:8px 0;
      border-left:3px solid #3498db;
      font-size:11px;
    }
    
    @media (min-width: 768px) {
      .tip {
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        border-left: 4px solid #3498db;
        font-size: 13px;
      }
    }
    
    .search-box{
      width:120px;
      padding:6px 8px;
      border:1px solid #dee2e6;
      border-radius:16px;
      margin-left:auto;
      font-size:11px;
    }
    
    @media (min-width: 480px) {
      .search-box {
        width: 160px;
      }
    }
    
    @media (min-width: 768px) {
      .search-box {
        width: 200px;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
      }
    }
    
    .hidden{
      display:none!important;
    }
    
    .modal{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1000;
      padding:16px;
    }
    
    .modal-content{
      background:white;
      padding:20px;
      border-radius:8px;
      max-width:340px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
    }
    
    @media (min-width: 768px) {
      .modal-content {
        padding: 30px;
        border-radius: 12px;
        max-width: 400px;
      }
    }
    
    .modal h3{
      margin-top:0;
      color:#2c3e50;
      font-size:16px;
    }
    
    @media (min-width: 768px) {
      .modal h3 {
        font-size: 18px;
      }
    }
    
    .modal input{
      width:100%;
      padding:10px;
      margin:8px 0;
      border:1px solid #dee2e6;
      border-radius:4px;
      box-sizing:border-box;
      font-size:14px;
    }
    
    @media (min-width: 768px) {
      .modal input {
        padding: 12px;
        margin: 10px 0;
        border-radius: 6px;
      }
    }
    
    .modal-buttons{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      margin-top:16px;
    }
    
    @media (min-width: 768px) {
      .modal-buttons {
        gap: 10px;
        margin-top: 20px;
      }
    }
    
    .session-info{
      font-size:10px;
      color:#7f8c8d;
      margin-left:6px;
      flex:1;
    }
    
    @media (min-width: 768px) {
      .session-info {
        font-size: 12px;
        margin-left: 10px;
      }
    }
    
    /* Touch-friendly improvements */
    @media (max-width: 767px) {
      .card {
        min-height: 90px;
        padding: 10px;
      }
      
      button {
        min-height: 44px;
        min-width: 44px;
      }
      
      .filter-btn {
        min-height: 36px;
        padding: 6px 10px;
      }
      
      input[type="text"] {
        min-height: 36px;
        padding: 8px;
      }
      
      .search-box {
        min-height: 36px;
      }
    }
    
    /* Landscape mobile adjustments */
    @media (max-height: 600px) and (orientation: landscape) {
      body {
        padding: 4px;
      }
      
      header {
        padding: 8px;
        margin-bottom: 8px;
      }
      
      .tip {
        padding: 6px;
        margin: 4px 0;
      }
      
      .controls, .filter-controls {
        margin: 8px 0;
      }
      
      #progress {
        margin: 8px 0;
      }
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
      .card {
        border-width: 3px;
      }
      
      .card:hover {
        border-width: 3px;
      }
    }
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
        animation: none !important;
      }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background: #1a1a1a;
        color: #e0e0e0;
      }
      
      header, .card, footer, .tip, .modal-content {
        background: #2d2d2d;
        border-color: #404040;
      }
      
      .card {
        border-color: #404040;
      }
      
      .card:hover {
        border-color: #3498db;
      }
      
      input[type="text"], .search-box {
        background: #404040;
        border-color: #555;
        color: #e0e0e0;
      }
      
      .filter-btn {
        background: #404040;
        border-color: #555;
        color: #e0e0e0;
      }
      
      .stat-label, .session-info {
        color: #aaa;
      }
      
      h1, .problem-number {
        color: #e0e0e0;
      }
    }
    
    /* Notification styles - mobile optimized */
    #notification {
      position: fixed !important;
      top: 16px !important;
      left: 16px !important;
      right: 16px !important;
      padding: 12px 16px !important;
      border-radius: 8px !important;
      font-size: 14px !important;
      font-weight: 500 !important;
      z-index: 1001 !important;
      opacity: 0 !important;
      transition: opacity 0.3s ease !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
      text-align: center !important;
      max-width: none !important;
    }
    
    @media (min-width: 768px) {
      #notification {
        top: 20px !important;
        right: 20px !important;
        left: auto !important;
        max-width: 300px !important;
        text-align: left !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>üîí 100 DSA Problems Tracker</h1>
      <div class="tip">
        <strong>Daily Target:</strong> Solve 14-15 problems/day to finish in 7 days!
        <br><strong>Security:</strong> Password required for all problem state changes
      </div>
    </div>
    <div class="stats">
      <div class="stat-item">
        <div class="stat-number" id="count">0</div>
        <div class="stat-label">Solved</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="remaining">100</div>
        <div class="stat-label">Remaining</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="percentage">0%</div>
        <div class="stat-label">Progress</div>
      </div>
    </div>
  </header>

  <div id="progress"><div id="bar"></div></div>

  <div class="controls">
    <button class="btn-warning" id="toggleLock">üîì Unlock</button>
    <span class="session-info" id="sessionInfo">Tap to unlock</span>
    <button class="btn-success" id="markAll">‚úì All</button>
    <button class="btn-danger" id="clear">üóëÔ∏è Clear</button>
    <button class="btn-primary" id="export">üìÅ Export</button>
    <button class="btn-secondary" id="importBtn">üìÇ Import</button>
    <input id="importFile" type="file" accept="application/json" style="display:none" />
  </div>

  <div class="filter-controls">
    <button class="filter-btn active" data-filter="all">All (100)</button>
    <button class="filter-btn" data-filter="solved">Solved (<span id="solvedCount">0</span>)</button>
    <button class="filter-btn" data-filter="unsolved">Unsolved (<span id="unsolvedCount">100</span>)</button>
    <input type="text" class="search-box" id="searchBox" placeholder="üîç Search...">
  </div>

  <div class="grid" id="grid"></div>

  <footer>
    <p><strong>üíæ Auto-Save:</strong> Progress automatically saved</p>
    <p><strong>üîí Security:</strong> All editing operations password protected</p>
    <p><strong>‚è±Ô∏è Session:</strong> Authentication expires after 5 minutes</p>
  </footer>

  <!-- Password Modal -->
  <div id="passwordModal" class="modal hidden">
    <div class="modal-content">
      <h3>üîê Enter Password</h3>
      <p id="passwordPrompt">Authentication required:</p>
      <input type="password" id="passwordInput" placeholder="Enter password">
      <div class="modal-buttons">
        <button class="btn-secondary" id="cancelPassword">Cancel</button>
        <button class="btn-primary" id="confirmPassword">Confirm</button>
      </div>
    </div>
  </div>

<script>
const STORAGE_KEY = 'dsa100_progress_v4';
const CORRECT_PASSWORD = 'surendar@123';
const SESSION_TIMEOUT = 5 * 60 * 1000; // 5 minutes in milliseconds

let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
let currentFilter = 'all';
let pendingAction = null;
let pendingProblemNum = null;
let isAuthenticated = false;
let sessionTimer = null;

// Initialize state if empty
if (Object.keys(state).length === 0) {
  for(let i = 1; i <= 100; i++) {
    state[`p${i}`] = {done: false, note: '', timestamp: null};
  }
  saveState();
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  refreshUI();
}

function startSessionTimer() {
  clearTimeout(sessionTimer);
  sessionTimer = setTimeout(() => {
    isAuthenticated = false;
    updateLockUI();
    showNotification('üîí Session expired. Please authenticate again.', 'warning');
  }, SESSION_TIMEOUT);
}

function updateLockUI() {
  const lockBtn = document.getElementById('toggleLock');
  const sessionInfo = document.getElementById('sessionInfo');
  const cards = document.querySelectorAll('.card');
  
  if (isAuthenticated) {
    lockBtn.textContent = 'üîì Unlocked';
    lockBtn.className = 'btn-success';
    sessionInfo.textContent = window.innerWidth < 768 ? 'Editing enabled' : 'Editing enabled - Auto-lock in 5 minutes';
    sessionInfo.style.color = '#27ae60';
    
    cards.forEach(card => card.classList.remove('locked'));
  } else {
    lockBtn.textContent = window.innerWidth < 768 ? 'üîí Unlock' : 'üîí Unlock Editing';
    lockBtn.className = 'btn-warning';
    sessionInfo.textContent = window.innerWidth < 768 ? 'Tap to unlock' : 'Click to authenticate and enable editing';
    sessionInfo.style.color = '#7f8c8d';
    
    cards.forEach(card => card.classList.add('locked'));
  }
}

function createGrid() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  
  for(let i = 1; i <= 100; i++) {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.problemId = i;
    
    const id = `p${i}`;
    const problemData = state[id] || {done: false, note: '', timestamp: null};
    
    if(problemData.done) {
      card.classList.add('solved');
    }
    
    if (!isAuthenticated) {
      card.classList.add('locked');
    }
    
    card.innerHTML = `
      <div class="problem-number">Problem ${i}</div>
      <input type="text" 
             placeholder="Solution link or notes..." 
             data-id="${id}_note" 
             value="${problemData.note || ''}" 
             onclick="event.stopPropagation()" 
             ontouchstart="event.stopPropagation()" />
    `;
    
    grid.appendChild(card);
  }
}

function toggleProblem(problemNum) {
  if (!isAuthenticated) {
    showPasswordModal('toggle', problemNum);
    return;
  }
  
  const id = `p${problemNum}`;
  const currentState = state[id].done;
  
  state[id].done = !currentState;
  state[id].timestamp = new Date().toISOString();
  
  // Update card appearance
  const card = document.querySelector(`[data-problem-id="${problemNum}"]`);
  if(state[id].done) {
    card.classList.add('solved');
    showNotification(`‚úÖ Problem ${problemNum} marked as solved!`, 'success');
  } else {
    card.classList.remove('solved');
    showNotification(`‚Ü©Ô∏è Problem ${problemNum} marked as unsolved!`, 'info');
  }
  
  saveState();
  startSessionTimer(); // Reset session timer on activity
}

function updateNote(problemId, note) {
  if (!isAuthenticated) {
    showNotification('üîí Please authenticate to edit notes', 'warning');
    return;
  }
  
  state[problemId].note = note.trim();
  saveState();
  startSessionTimer(); // Reset session timer on activity
}

function refreshUI() {
  const solved = Object.values(state).filter(x => x.done).length;
  const remaining = 100 - solved;
  const percentage = Math.round((solved / 100) * 100);
  
  document.getElementById('count').textContent = solved;
  document.getElementById('remaining').textContent = remaining;
  document.getElementById('percentage').textContent = percentage + '%';
  document.getElementById('bar').style.width = percentage + '%';
  
  // Update filter counts
  document.getElementById('solvedCount').textContent = solved;
  document.getElementById('unsolvedCount').textContent = remaining;
  
  applyFilter();
}

function applyFilter() {
  const cards = document.querySelectorAll('.card');
  const searchTerm = document.getElementById('searchBox').value.toLowerCase();
  
  cards.forEach(card => {
    const problemNum = card.dataset.problemId;
    const isSolved = state[`p${problemNum}`].done;
    const problemText = card.textContent.toLowerCase();
    const noteText = (state[`p${problemNum}`].note || '').toLowerCase();
    
    let show = true;
    
    // Filter by status
    if(currentFilter === 'solved' && !isSolved) show = false;
    if(currentFilter === 'unsolved' && isSolved) show = false;
    
    // Filter by search
    if(searchTerm && !problemText.includes(searchTerm) && !noteText.includes(searchTerm)) {
      show = false;
    }
    
    card.style.display = show ? 'block' : 'none';
  });
}

function showPasswordModal(action, problemNum = null) {
  pendingAction = action;
  pendingProblemNum = problemNum;
  
  const modal = document.getElementById('passwordModal');
  const prompt = document.getElementById('passwordPrompt');
  
  if (action === 'toggle' && problemNum) {
    const currentState = state[`p${problemNum}`].done;
    const actionText = currentState ? 'unmark' : 'mark as solved';
    prompt.textContent = `Authentication required to ${actionText} Problem ${problemNum}:`;
  } else if (action === 'unlock') {
    prompt.textContent = 'Authentication required to unlock editing mode:';
  } else {
    prompt.textContent = 'This action requires password verification:';
  }
  
  modal.classList.remove('hidden');
  
  // Focus input after a short delay to ensure modal is visible
  setTimeout(() => {
    document.getElementById('passwordInput').focus();
  }, 100);
}

function hidePasswordModal() {
  document.getElementById('passwordModal').classList.add('hidden');
  document.getElementById('passwordInput').value = '';
  pendingAction = null;
  pendingProblemNum = null;
}

function executeProtectedAction() {
  const password = document.getElementById('passwordInput').value;
  
  if(password === CORRECT_PASSWORD) {
    if(pendingAction === 'clear') {
      clearAllProgress();
    } else if(pendingAction === 'markAll') {
      markAllSolved();
    } else if(pendingAction === 'toggle' && pendingProblemNum) {
      isAuthenticated = true;
      updateLockUI();
      startSessionTimer();
      toggleProblem(pendingProblemNum);
    } else if(pendingAction === 'unlock') {
      isAuthenticated = true;
      updateLockUI();
      startSessionTimer();
      showNotification('üîì Editing mode unlocked for 5 minutes!', 'success');
    }
    hidePasswordModal();
  } else {
    showNotification('‚ùå Incorrect password! Please try again.', 'error');
    document.getElementById('passwordInput').value = '';
    setTimeout(() => {
      document.getElementById('passwordInput').focus();
    }, 100);
  }
}

function clearAllProgress() {
  for(let i = 1; i <= 100; i++) {
    state[`p${i}`] = {done: false, note: '', timestamp: null};
  }
  saveState();
  createGrid();
  showNotification('‚úÖ All progress cleared successfully!', 'success');
}

function markAllSolved() {
  const timestamp = new Date().toISOString();
  for(let i = 1; i <= 100; i++) {
    state[`p${i}`].done = true;
    state[`p${i}`].timestamp = timestamp;
  }
  saveState();
  createGrid();
  showNotification('üéâ All problems marked as solved!', 'success');
}

function showNotification(message, type = 'info') {
  const colors = {
    success: '#27ae60',
    error: '#e74c3c',
    warning: '#f39c12',
    info: '#3498db'
  };
  
  let notification = document.getElementById('notification');
  if(!notification) {
    notification = document.createElement('div');
    notification.id = 'notification';
    document.body.appendChild(notification);
  }
  
  notification.textContent = message;
  notification.style.background = colors[type];
  notification.style.color = 'white';
  notification.style.opacity = '1';
  
  setTimeout(() => {
    notification.style.opacity = '0';
  }, 3000);
}

// Handle window resize for responsive UI updates
function handleResize() {
  updateLockUI();
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
  createGrid();
  refreshUI();
  updateLockUI();
});

window.addEventListener('resize', handleResize);

// Grid click/touch handler
document.getElementById('grid').addEventListener('click', function(e) {
  const card = e.target.closest('.card');
  if(!card || card.classList.contains('locked')) {
    if (!isAuthenticated) {
      showNotification('üîí Please unlock editing mode first', 'warning');
    }
    return;
  }
  
  const problemNum = parseInt(card.dataset.problemId);
  toggleProblem(problemNum);
});

// Touch events for better mobile experience
document.getElementById('grid').addEventListener('touchstart', function(e) {
  const card = e.target.closest('.card');
  if(card && !card.classList.contains('locked')) {
    card.style.transform = 'scale(0.98)';
  }
});

document.getElementById('grid').addEventListener('touchend', function(e) {
  const card = e.target.closest('.card');
  if(card) {
    card.style.transform = '';
  }
});

// Note input handler
document.getElementById('grid').addEventListener('input', function(e) {
  if(e.target.matches('input[type="text"]')) {
    const problemId = e.target.dataset.id.replace('_note', '');
    updateNote(problemId, e.target.value);
  }
});

// Note input focus handler (to show auth warning)
document.getElementById('grid').addEventListener('focus', function(e) {
  if(e.target.matches('input[type="text"]') && !isAuthenticated) {
    showNotification('üîí Please unlock editing mode to modify notes', 'warning');
    e.target.blur();
  }
}, true);

// Toggle lock button
document.getElementById('toggleLock').addEventListener('click', function() {
  if (isAuthenticated) {
    isAuthenticated = false;
    clearTimeout(sessionTimer);
    updateLockUI();
    showNotification('üîí Editing mode locked', 'info');
  } else {
    showPasswordModal('unlock');
  }
});

// Filter buttons
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    currentFilter = this.dataset.filter;
    applyFilter();
  });
});

// Search box
document.getElementById('searchBox').addEventListener('input', applyFilter);

// Control buttons
document.getElementById('clear').addEventListener('click', () => {
  showPasswordModal('clear');
});

document.getElementById('markAll').addEventListener('click', () => {
  if(confirm('Mark all 100 problems as solved?')) {
    showPasswordModal('markAll');
  }
});

document.getElementById('export').addEventListener('click', function() {
  const exportData = {
    ...state,
    exportDate: new Date().toISOString(),
    totalSolved: Object.values(state).filter(x => x.done).length
  };
  
  const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `dsa100_progress_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  
  showNotification('üìÅ Progress exported successfully!', 'success');
});

document.getElementById('importBtn').addEventListener('click', function() {
  document.getElementById('importFile').click();
});

document.getElementById('importFile').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  if(!file) return;
  
  try {
    const text = await file.text();
    const importedData = JSON.parse(text);
    
    // Validate imported data
    const validKeys = Object.keys(importedData).filter(key => key.startsWith('p') && parseInt(key.slice(1)) <= 100);
    
    if(validKeys.length > 0) {
      if(confirm(`Import progress? This will overwrite current data.\nFound ${validKeys.length} problem entries.`)) {
        // Merge imported data
        for(let key of validKeys) {
          if(importedData[key] && typeof importedData[key] === 'object') {
            state[key] = {
              done: !!importedData[key].done,
              note: importedData[key].note || '',
              timestamp: importedData[key].timestamp || new Date().toISOString()
            };
          }
        }
        
        saveState();
        createGrid();
        showNotification('‚úÖ Progress imported successfully!', 'success');
      }
    } else {
      showNotification('‚ùå Invalid file format. Please select a valid progress file.', 'error');
    }
  } catch(error) {
    showNotification('‚ùå Failed to import: ' + error.message, 'error');
  }
  
  // Reset file input
  this.value = '';
});

// Password modal handlers
document.getElementById('cancelPassword').addEventListener('click', hidePasswordModal);
document.getElementById('confirmPassword').addEventListener('click', executeProtectedAction);

// Enter key in password input
document.getElementById('passwordInput').addEventListener('keypress', function(e) {
  if(e.key === 'Enter') {
    executeProtectedAction();
  }
});

// Close modal when clicking outside
document.getElementById('passwordModal').addEventListener('click', function(e) {
  if(e.target === this) {
    hidePasswordModal();
  }
});

// Keyboard shortcuts (only for desktop)
document.addEventListener('keydown', function(e) {
  if(window.innerWidth >= 768 && (e.ctrlKey || e.metaKey)) {
    switch(e.key) {
      case 's':
        e.preventDefault();
        document.getElementById('export').click();
        break;
      case 'f':
        e.preventDefault();
        document.getElementById('searchBox').focus();
        break;
      case 'l':
        e.preventDefault();
        document.getElementById('toggleLock').click();
        break;
    }
  }
});

// Reset session timer on any user activity
document.addEventListener('click', function() {
  if (isAuthenticated) {
    startSessionTimer();
  }
});

document.addEventListener('keypress', function() {
  if (isAuthenticated) {
    startSessionTimer();
  }
});

document.addEventListener('touchstart', function() {
  if (isAuthenticated) {
    startSessionTimer();
  }
});

// Prevent zoom on iOS when focusing inputs
document.addEventListener('touchstart', function(e) {
  if(e.target.matches('input[type="text"], input[type="password"]')) {
    e.target.style.fontSize = '16px';
  }
});

// Restore font size after blur
document.addEventListener('blur', function(e) {
  if(e.target.matches('input[type="text"], input[type="password"]')) {
    if(window.innerWidth < 768) {
      e.target.style.fontSize = '11px';
    } else {
      e.target.style.fontSize = '12px';
    }
  }
}, true);

// Handle orientation changes
window.addEventListener('orientationchange', function() {
  setTimeout(() => {
    updateLockUI();
    // Scroll to top on orientation change to avoid weird positioning
    window.scrollTo(0, 0);
  }, 100);
});

// Prevent pull-to-refresh on mobile
document.addEventListener('touchstart', function(e) {
  if(e.touches.length !== 1) return;
  
  const touch = e.touches[0];
  const target = e.target.closest('.card, button, input, .filter-btn');
  
  if(!target && touch.clientY > 100) {
    e.preventDefault();
  }
}, {passive: false});

document.addEventListener('touchmove', function(e) {
  if(e.touches.length !== 1) return;
  
  const touch = e.touches[0];
  if(touch.clientY < 100 && window.scrollY === 0) {
    e.preventDefault();
  }
}, {passive: false});
  // Disable right-click
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
  showNotification('üö´ Right-click disabled', 'warning');
  return false;
});

// Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+Shift+C
document.addEventListener('keydown', function(e) {
  // F12
  if(e.key === 'F12') {
    e.preventDefault();
    showNotification('üö´ Developer tools disabled', 'warning');
    return false;
  }
  
  // Ctrl+Shift+I (Inspector)
  if(e.ctrlKey && e.shiftKey && e.key === 'I') {
    e.preventDefault();
    showNotification('üö´ Developer tools disabled', 'warning');
    return false;
  }
  
  // Ctrl+Shift+J (Console)
  if(e.ctrlKey && e.shiftKey && e.key === 'J') {
    e.preventDefault();
    showNotification('üö´ Developer tools disabled', 'warning');
    return false;
  }
  
  // Ctrl+Shift+C (Element selector)
  if(e.ctrlKey && e.shiftKey && e.key === 'C') {
    e.preventDefault();
    showNotification('üö´ Developer tools disabled', 'warning');
    return false;
  }
  
  // Ctrl+U (View source)
  if(e.ctrlKey && e.key === 'u') {
    e.preventDefault();
    showNotification('üö´ View source disabled', 'warning');
    return false;
  }
});

// Detect if DevTools is open
(function() {
  const element = new Image();
  Object.defineProperty(element, 'id', {
    get: function() {
      showNotification('üö´ Developer tools detected', 'error');
      throw new Error('DevTools detected');
    }
  });
  setInterval(function() {
    console.log(element);
    console.clear();
  }, 1000);
})();

// Disable text selection for the entire page
document.addEventListener('selectstart', function(e) {
  if(!e.target.matches('input[type="text"], input[type="password"], textarea')) {
    e.preventDefault();
  }
});

// Disable copy
document.addEventListener('copy', function(e) {
  if(!e.target.matches('input[type="text"], input[type="password"], textarea')) {
    e.preventDefault();
    showNotification('üö´ Copy disabled', 'warning');
  }
});


</script>
</body>
</html>
